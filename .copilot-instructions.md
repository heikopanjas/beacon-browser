# BLEScanner - Copilot Instructions

## Project Overview
BLEScanner is a Swift command-line tool for scanning and analyzing Bluetooth Low Energy (BLE) devices. It provides detailed information about discovered devices including manufacturer data, signal strength, and device-specific parsing for major manufacturers.

## Architecture & Technologies
- **Language**: Swift 6.1+
- **Framework**: Swift Package Manager (SPM)
- **Dependencies**:
  - Swift Argument Parser 1.2.0+ for CLI interface
  - CoreBluetooth for BLE functionality
- **Platform**: macOS (requires Bluetooth LE support)

## Project Structure
```
BLEScanner/
├── Package.swift                 # Swift Package Manager configuration
├── Package.resolved             # Dependency lock file
├── Sources/
│   └── BLEScanner.swift         # Main application code
├── .build/                      # Build artifacts (auto-generated)
└── .vscode/                     # VS Code configuration
```

## Core Components

### Scanner Class
- **Purpose**: Main BLE scanning implementation
- **Responsibilities**:
  - CoreBluetooth central manager delegate
  - Device discovery and advertisement data parsing
  - Signal quality analysis and distance estimation
  - Manufacturer-specific data interpretation

### Manufacturer Data Parsing
The tool includes specialized parsers for:
- **Apple**: iBeacon, AirPods, Handoff/Continuity, Nearby/AirDrop
- **Microsoft**: CDP (Cross Device Protocol), Surface devices
- **Samsung**: Device-specific data structures
- **Nordic Semiconductor**: Development/test devices
- **Govee**: Smart home devices (LED strips, sensors)
- **Generic**: Unknown manufacturers with pattern detection

### Signal Analysis
- RSSI-based signal quality assessment (Excellent to Barely Detectable)
- Distance estimation based on signal strength
- TX Power level reporting when available

## Development Guidelines

### Code Style
- Follow Swift naming conventions (camelCase, PascalCase for types)
- Use meaningful variable and function names
- Prefer explicit types when clarity is improved
- Use guard statements for early returns
- Implement proper error handling

### Adding New Manufacturer Support
1. Add company identifier to the `companies` dictionary in `getManufacturerName()`
2. Add case to the switch statement in `parseManufacturerSpecificData()`
3. Implement dedicated parsing function following pattern: `parse{Company}ManufacturerData()`
4. Include detailed comments about data structure interpretation

### Data Analysis Patterns
- Use hexdump for raw data visualization
- Implement structured parsing with field-by-field analysis
- Provide meaningful interpretations of numeric values
- Include ASCII representation when applicable
- Add context about device capabilities and expected behavior

### Testing Considerations
- Test with real BLE devices when possible
- Verify manufacturer data parsing accuracy
- Test signal strength calculations across different distances
- Validate edge cases (empty data, incomplete packets)

### Git Commit Guidelines
When the user asks to commit changes, follow this automated workflow:

#### Commit Process
1. **Stage all changes**: Use `git add .` to stage all modified files
2. **Generate commit message**: Create detailed but concise commit messages using conventional commits format
3. **Commit changes**: Execute the commit with the generated message
4. **Update instructions**: Always update this `.copilot-instructions.md` file as the project evolves

#### Conventional Commit Format
- `feat:` for new features (e.g., new manufacturer support, CLI options)
- `fix:` for bug fixes (e.g., parsing errors, memory leaks)
- `docs:` for documentation updates (e.g., README changes, code comments)
- `refactor:` for code refactoring (e.g., function reorganization, performance improvements)
- `test:` for adding or modifying tests
- `chore:` for maintenance tasks (e.g., dependency updates, build configuration)
- `style:` for code style changes (formatting, missing semicolons, etc.)
- `perf:` for performance improvements

#### Commit Message Structure
```
<type>(<scope>): <description>

[optional body]

[optional footer(s)]
```

#### Examples
- `feat(parser): add support for Govee device manufacturer data parsing`
- `fix(scanner): resolve memory leak in CoreBluetooth delegate`
- `docs: update copilot instructions with git workflow`
- `refactor(signal): improve RSSI distance calculation accuracy`
- `chore(deps): update Swift Argument Parser to 1.3.0`

#### Automated Workflow Trigger
When user says "commit the latest changes" or similar:
1. Automatically stage all changes with `git add .`
2. Generate appropriate conventional commit message based on the changes
3. Execute `git commit -m "<generated-message>"`
4. Confirm completion to user

## Build & Run Instructions

### Development
```bash
swift build
swift run
```

### Release Build
```bash
swift build -c release
```

### Dependencies Update
```bash
swift package update
```

## CLI Usage
The tool starts scanning immediately and displays detailed information about discovered BLE devices. Use Ctrl+C to stop scanning gracefully.

## Data Structure Notes

### Advertisement Data Keys
- `CBAdvertisementDataLocalNameKey`: Device local name
- `CBAdvertisementDataManufacturerDataKey`: Manufacturer-specific data
- `CBAdvertisementDataServiceUUIDsKey`: Advertised service UUIDs
- `CBAdvertisementDataServiceDataKey`: Service-specific data
- `CBAdvertisementDataTxPowerLevelKey`: Transmission power level
- `CBAdvertisementDataIsConnectable`: Connection capability
- `CBAdvertisementDataSolicitedServiceUUIIDsKey`: Requested services
- `CBAdvertisementDataOverflowServiceUUIDsKey`: Additional services

### Common Manufacturer Data Formats
- **Company ID**: First 2 bytes (little-endian)
- **Apple iBeacon**: 23 bytes total (UUID + Major + Minor + TX Power)
- **Govee Devices**: Status/config data with device type identification
- **Nordic**: Development device type and version information

## Future Enhancement Ideas
- Add support for connecting to discovered devices
- Implement service and characteristic exploration
- Add filtering options (by manufacturer, signal strength, etc.)
- Create output formats (JSON, CSV) for data analysis
- Add device tracking and change detection over time
- Implement manufacturer data decoding for additional companies

## Security & Privacy Notes
- Tool only scans advertising data (passive monitoring)
- No device connections are established by default
- Respects BLE privacy features and MAC address randomization
- Consider privacy implications when logging device identifiers

## Troubleshooting
- Ensure Bluetooth is enabled and powered on
- Check macOS privacy settings for Bluetooth access
- Verify device is in advertising mode for testing
- Some devices may use randomized MAC addresses
- Signal strength varies with environment and obstacles

---
*This file should be updated as the project evolves and new features are added.*
